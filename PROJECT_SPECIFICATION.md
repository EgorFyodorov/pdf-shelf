# PDF Shelf - Телеграм-бот для конвертации ссылок в PDF

## Описание проекта

PDF Shelf — телеграм-бот для автоматической конвертации веб-страниц в PDF-файлы с анализом контента. Бот понимает естественный язык пользователя и предлагает решения без лишних вопросов.

### Основные возможности

- Автоматическая конвертация ссылок в PDF
- Понимание естественного языка пользователя
- MCP-анализ — объём, сложность, тематика материалов
- Напоминания с автоматическим планированием
- Пакетная обработка нескольких ссылок
- Персонализация на основе предпочтений пользователя

---

## Принципы работы

### LLM-First подход

Бот работает по принципу "одна фраза → готовый результат":
- Пользователь пишет естественным языком: "напомни завтра утром" + ссылка
- Бот понимает намерение и подставляет оптимальные дефолты
- Максимум один уточняющий вопрос при необходимости
- Минимум кнопок — только подтверждения и быстрые варианты

### Поведение по умолчанию

- Прислал ссылку → приходит PDF и короткая карточка анализа
- Если в тексте есть время → трактуется как напоминание
- Если текст длинный → бот сам предложит разумный план разбиения
- Меню минимальны: `/start`, `/help`, `/list`, `/settings`, `/cancel`

---

## Пользовательские сценарии

### 1. Прислал ссылку — получил результат

**Пользователь:** отправляет ссылку

**Бот:** 
- Конвертирует страницу в PDF
- Прикладывает файл с короткой карточкой:
  ```
  Объём: 12 стр. (~11 мин)
  Сложность: Средняя
  Темы: ML, Наука
  ```
- Предлагает 3 умных варианта напоминания:
  - Сегодня 20:00
  - Завтра 08:30
  - В выходные 10:00
  - Ещё варианты

**Результат:** Пользователь одним тапом ставит напоминание или просто получает PDF.

---

### 2. Ссылка + время в тексте

**Пользователь:** "напомни завтра утром" + ссылка

**Бот:** 
- Распознаёт "завтра утром" → 08:00 в часовом поясе пользователя
- Отвечает: "Запланировал на завтра 08:00 (UTC+3). Подтвердить/Изменить/Отмена"

**После подтверждения:** В назначенное время приходит PDF + карточка анализа.

---

### 3. Длинный материал → авто-расписание

**Пользователь:** отправляет ссылку

**Бот:** 
- Видит по MCP, что чтение 35 мин
- Предлагает: "Текст объёмный. Разбить на 2 сессии по 18 мин: Сегодня 20:00 и Завтра 20:00?"
- Кнопки: Подтвердить/Изменить/Отмена

**После подтверждения:** Бот создаёт серию напоминаний и присылает PDF.

---

### 4. Несколько ссылок одним сообщением

**Пользователь:** отправляет 3 ссылки

**Бот:**
- Распознаёт все URL
- Кратко перечисляет с оценкой объёма/тематики
- Предлагает: "Сделать все к субботе 10:00?"
- Кнопки: Подтвердить/Изменить/Отмена, "Пропустить #2"

**Результат:** Пакетная обработка, в назначенное время приходит подборка.

---

### 5. Управление расписанием

**Пользователь:** "перенеси статью про экономику на понедельник 19:00"

**Бот:** 
- Находит материал по теме/названию
- Меняет время: "Готово: Пн 19:00 (UTC+3)"

Аналогично работают: "отмени напоминание", "поставь на вечер", "через два часа".

---

### 8. Поиск по тегам

**Пользователь:** "покажи материалы по ML" или "найди статьи про экономику"

**Бот:**
- Ищет материалы по указанным тегам из MCP-анализа
- Показывает список найденных материалов с краткой информацией:
  - Название и домен
  - Объём и сложность
  - Дата добавления
- Кнопки: Открыть, Запланировать, Удалить

**Поиск работает:**
- По одному или нескольким тегам
- По частичному совпадению тегов
- В команде `/list` можно фильтровать по тегам
- Естественным языком: "статьи про технологии", "материалы по науке"

---

### 6. Прямая ссылка на PDF

**Пользователь:** отправляет прямой публичный PDF

**Бот:** 
- Скачивает файл
- Делает MCP-анализ
- Присылает PDF и карточку

Если не хочется анализа — можно отключить в настройках.

---

### 7. После доставки — умные дополнения

**Пользователь:** "дай тезисы" под присланным PDF

**Бот:** 
- Краткое резюме в 5 пунктах
- Предлагает: "вопросы для самопроверки", "глоссарий терминов"

Все триггерятся обычными фразами: "спроси меня завтра", "сделай карточки".

---

## Разделение ответственности: LLM vs Правила

### LLM отвечает за:
- Извлечение намерений из естественного языка
- Парсинг относительного времени ("вечером", "после работы")
- Поиск референтов ("про экономику")
- Тон ответа, язык коммуникации
- Генерация саммари/вопросов/глоссариев
- Предложение умных слотов на основе MCP и предпочтений

### Правила (код) отвечают за:
- Валидация URL, доступность, дубликаты
- Планирование задач, TZ, дедлайны
- Ретраи и таймауты
- Форматы сообщений, кнопки
- Права доступа, лимиты
- Безопасность (ограничение сети конвертера)

---

## Примеры сообщений

### После конверсии

```
PDF "Как устроен X"
example.com

Объём: 12 стр. (1.3 МБ) • 2.8k слов (11 мин)
Сложность: Средняя
Тематика: Технологии, Бизнес

[Сегодня 20:00] [Завтра 08:30] [В выходные 10:00] [Ещё…]
```

### Подтверждение планирования

```
Запланировано: Сб, 16 ноя, 10:00 (UTC+3)
Принесу PDF и краткий анализ.

[Изменить время] [Отменить] [Готово]
```

### Только анализ

```
Анализ: "Заголовок" (example.com)

Объём: 1.9k слов (7 мин)
Сложность: Лёгкая
Тематика: Экономика

[Сконвертировать в PDF] [Запланировать]
```

### Ошибка с вариантами

```
Страница закрыта. Могу сохранить 'печатью в PDF' 
(может выглядеть грубее) или подождать публичный доступ.

[Снимок] [Подождать] [Отмена]
```

---

## Формат MCP-информации

### Карточка анализа

**Где показываем:**
- В подписи под PDF
- В карточке "Только анализ"
- В списках — кратко (1–2 тега)

**Формат:**
```
Заголовок (если нашли) и домен

Объём: N страниц PDF и размер файла
       X слов (Y мин чтения)

Сложность: Лёгкая / Средняя / Сложная
           Краткое пояснение

Тематика: Тег1, Тег2, Тег3
```

**Уровни сложности:**
- Лёгкая — простые формулировки, бытовой/популярный стиль
- Средняя — профильная терминология, требуется внимательное чтение
- Сложная — академический/технический текст, высокая плотность терминов

---

## Команды бота

Минимальный набор команд:

- `/start` — приветствие и онбординг
- `/help` — короткая справка
- `/list` — список материалов (запланированные и последние готовые)
  - Можно фильтровать по тегам: `/list ML` или `/list экономика, политика`
- `/settings` — настройки
- `/cancel` — прерывание текущего "мастера"

Всё остальное — свободный текст, который понимает бот.

### Поиск по тегам

Поиск материалов по тегам доступен несколькими способами:

1. **Через команду `/list`** с указанием тегов:
   - `/list ML` — материалы с тегом "ML"
   - `/list экономика, политика` — материалы с любым из указанных тегов

2. **Естественным языком:**
   - "покажи материалы по ML"
   - "найди статьи про экономику"
   - "что у меня есть по технологиям"

3. **В интерфейсе списка** — кнопки для быстрого фильтра по популярным тегам

Поиск работает по тегам, которые автоматически определяются MCP-анализатором при обработке материала. Можно искать по одному тегу или комбинации тегов.

---

## Настройки

Настройки доступны через команду `/settings` или кнопку "Настройки". Все параметры сохраняются и используются для персонализации работы бота.

### Время и часовой пояс

- **Часовой пояс** — автоматическое определение или ручной выбор (например, UTC+3)
- Используется для расчёта времени напоминаний и предложения слотов

### Параметры чтения

- **Длительность стандартной сессии чтения** — время одной сессии при разбиении длинных материалов (по умолчанию 15–20 минут)
  - Влияет на то, как бот предлагает разбивать объёмные тексты
  - Можно задать от 10 до 60 минут
- **Порог для разбиения** — минимальная длительность материала, при которой бот предложит разбить на сессии (по умолчанию 25 минут)

### Формат выдачи по умолчанию

- **PDF + анализ** — всегда присылать PDF с карточкой анализа (по умолчанию)
- **Только PDF** — без анализа
- **Только анализ** — только карточка без PDF

### Пресеты времени

Настройка быстрых вариантов времени для напоминаний:

- **Утро** — время для утренних напоминаний (по умолчанию 08:00)
- **День** — время для дневных напоминаний (по умолчанию 13:00)
- **Вечер** — время для вечерних напоминаний (по умолчанию 20:00)
- **Выходные** — время для напоминаний в выходные (по умолчанию 10:00)

### Именование файлов

Шаблон для автоматического именования PDF-файлов:

- `{title}.pdf` — по названию материала
- `{domain}-{date}.pdf` — домен и дата
- `{title}-{date}.pdf` — название и дата
- Произвольный шаблон с доступными переменными

### Уведомления

- **Уведомления о готовности** — включить/выключить уведомления при завершении обработки
- **Тихая отправка** — отправка материалов по расписанию без звука
- **Пересылка в сохранённые** — автоматическая пересылка PDF в сохранённые сообщения

### Анализ контента

- **Включить MCP-анализ** — выполнять анализ объёма, сложности и тематики (по умолчанию включено)
- **Глубина анализа** — базовый (только метрики) или расширенный (с пояснениями)

### Язык интерфейса

- Выбор языка для сообщений бота (русский, английский и т.д.)

### Хранение данных

- **Срок хранения готовых файлов** — автоматическое удаление через указанное время (30 дней, 90 дней, никогда)
- **Срок хранения очереди** — удаление невыполненных напоминаний через указанное время

---

## Итог

PDF Shelf работает по принципу "одна фраза → готовый результат". Пользователь может просто прислать ссылку и получить PDF с аналитикой, или указать время доставки естественным языком. Бот автоматически подбирает оптимальные варианты и задаёт максимум один уточняющий вопрос при необходимости.

**Ключевые возможности:**
- Минимум действий от пользователя
- Понимание намерений из естественного языка
- Аналитика контента (объём, сложность, тематика)
- Гибкое планирование напоминаний
- Простой интерфейс

